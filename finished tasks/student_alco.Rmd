---
title: "Анализ данных об употреблении алкоголя школьниками"
author: "Б. Романов, М. Вотякова, Д. Пак"
output:
  html_document:
    toc: yes
    toc_float: yes
    toc_depth: 3
---



# Анализ


```{r Загрузка библиотек}
library (tidyverse)
library(readxl)
library(scales)
std <- read_excel('student-mat.xlsx')
```

## Вопрос 1: Можем ли анализировать данные об учениках двух школ совместно?



### Сколько наблюдений в каждой школе?

```{r Посчитайте наблюдения в каждой школе}

ggplot(data = std) +
  geom_bar(mapping = aes(x = school, y = ..count..)) +
  labs(
    title = "Количество наблюдений по школам",
    x = "Школы",
    y = "Количество наблюдений"
  )

gp <- filter(std, school == 'Gabriel Pereira')
mds <- filter(std, school == 'Mousinho da Silveira')

dim(gp)
dim(mds)
```

**Вывод:** Большую часть выборки - 349 наблюдений - составляют данные из школы Gabriel Pereira, оставшиеся 46 наблюдений получены из школы Mousinho da Silveira.

### Похожи ли распределения возрастов в школах?

```{r Сравните возрастные распределения}

ggplot(data = std) +
  geom_histogram(mapping = aes(x=age, y = ..count..), binwidth =  1) +
  facet_wrap(~school) +
  labs(
    title = "Возрастные распределения",
    x = "Возраст",
    y = "Частота"
  )
```

**Вывод:** В школе Gabriel Pereira (GP) более молодые ученики - преобладают ученики 15-17 лет, в то время как в школе Mousinho da Silveira (MDS) преобладают 18-ти летние ученики.


### Каковы соотношения количества девочек и мальчиков в этих двух школах?

```{r Соотношение полов}

ggplot(std) +
  geom_bar(aes(x=school, fill = sex), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Соотношение полов",
    x = "Школа",
    y = "Соотношение",
    fill = "Пол"
  )
```

**Вывод:** В обеих школах примерно равный гендерный состав.

### Каковы соотношения учащихся из городских и сельских районов в этих двух школах?

```{r Соотношение сельских и городских жителей}

ggplot(std) +
  geom_bar(aes(x=school, fill = address), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Соотношение районов",
    x = "Школа",
    y = "Соотношение",
    fill = "Район"
  )
```

**Вывод:** В школе GP преобладают ученики, проживающие в городских районах, а в школе MDS примерно поровну, хотя учеников из сельских районов все-таки немного больше.

### Похожи ли размеры семей в этих школах?

```{r Размеры семей по школам}

ggplot(std) +
  geom_bar(aes(x=school, fill = famsize), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Соотношение размеров семей",
    x = "Школа",
    y = "Соотношение",
    fill = "Размер семьи"
  )
```

**Вывод:** В обеих школах преобладают ученики из многодетных семей. В школе MDS, однако, доля таких учеников меньше.

### Похожи ли уровни образования родителей учеников этих школ?

```{r Уровень образования родителей по школам}

ggplot(std) +
  geom_bar(aes(x=school, fill = Medu), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Образование матери",
    x = "Школа",
    y = "Соотношение",
    fill = "Уровень образования"
  ) 
ggplot(std) +
  geom_bar(aes(x=school, fill =Fedu), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Образование отца",
    x = "Школа",
    y = "Соотношение",
    fill = "Уровень образования"
  ) 
```

**Вывод:** В школе обеих школах больше матерей имеют высшее образование, по сравнению с отцами. В школе GP меньше матерей, чем отцов имеют начальное образование, а в MDS - наоборот - отцов с начальным образованием больше. При этом четко видно, что в MDS большая доля родителей с начальным образованием, чем в GP. Также в GP больше родителей с высшим и средним образованием. Еще одна заметная характеристика - в GP есть родители без образования.

### Похожи ли занятия родителей учеников этих школ?

```{r Занятия родителей по школам}

ggplot(std) +
  geom_bar(aes(x=school, fill = Mjob), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Занятия матери",
    x = "Школа",
    y = "Соотношение",
    fill = "Занятие"
  ) 
ggplot(std) +
  geom_bar(aes(x=school, fill =Fjob), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Занятия отца",
    x = "Школа",
    y = "Соотношение",
    fill = "Занятие"
  )
```

**Вывод:** Значительно больше домохозяек среди матерей в обеих школах (в MDS больше, чем в GP). Разнообразие занятий женщин больше, чем мужчин. Среди мужчин преобладает занятие "прочее" и "служба". В школе MDS среди мужчин нет работников здравоохранения.

### Похожи ли причины выбора школы для учеников этих школ?

```{r Причины выбора школы}

ggplot(std) +
  geom_bar(aes(x=school, fill = reason), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Причины выбора",
    x = "Школа",
    y = "Соотношение",
    fill = "Причина"
  ) 
```

**Вывод:** Репутация GP является более значимым фактором при выборе школы, чем при выборе MDS. Препочтение курсу в MDS играет большую роль, чем в GP. Кроме того, "прочее" чаще выбирают в школе MDS.

### Схожи ли уровни потребления алкоголя среди учеников этих школ?



```{r Потребление алкоголя среди учеников}

ggplot(std) +
  geom_bar(aes(x=school, fill = Dalc), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Употребление алкоголя в будни",
    x = "Школа",
    y = "Соотношение",
    fill = "Потребление"
  ) 

ggplot(std) +
  geom_bar(aes(x=school, fill = Walc), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Употребление алкоголя в выходные",
    x = "Школа",
    y = "Соотношение",
    fill = "Потребление"
  ) 
```

**Вывод:**  
Рабочее время: Большинство употребляют крайне мало или мало (в целом в GP употребляют меньше алкоголя, чем MDS).В школе MDS существенно больше школьников, употребляющих алкоголь на среднем уровне.  
Выходные: На выходных употребление алкоголя увеличивается. Причем в MDS возрастает доля употребления на среднем уровне, при этом в GP все еще больше школьников употребляют алкоголь на очень низком уровне.



### Являются ли отношения между потреблением алкоголя и успеваемостью ученика одинаковыми во всех школах?


```{r Потребление алкоголя и финальные оценки}

ggplot(std,
  mapping = aes (x = Walc, fill = school, y = G3)) +
  geom_boxplot() +
  labs(
    title = "Потребление алкоголя и финальные оценки",
    x = "Уровень потребления",
    y = "Оценка",
    fill = "Школа")
```

**Вывод:** Анализируя данную визуацию, трудно определить зависимость между уровнем потребления алкоголя и оценками учеников в разных школах. Очевидным является то, что почти не пьющие имеют наиболее высокие результаты в обеих школах. 
Уровень успеваемости оказался выше в школе Gabriel Pereira. В другой школе разброс оказался явно существеннее, однако, определить четкую зависимость возможным не продоставляется.



```{r Подвыборка по школе Gabriel Pereira}
#alco_gp <- filter(alco, school == 'Gabriel Pereira')
# Преобразования не требуются: см. ниже
```
**Подвыборка была сделана ранее и загружена в переменную gp.**

## Вопрос 2: Коррелирует ли употребление алкоголя с успеваемостью учеников?


```{r Употребление алкоголя и успеваемость}

ggplot(gp,
  mapping = aes (x = Walc, y = absences)) +
  geom_boxplot() +
  labs(
    title = "Потребление алкоголя и прогулы",
    x = "Уровень потребления",
    y = "Количество прогулов"
  )
ggplot(gp,
  mapping = aes (x = Walc, y = failures)) +
  geom_boxplot() +
  labs(
    title = "Потребление алкоголя и незачи",
    x = "Уровень потребления",
    y = "Количество незачей"
  )

```

**Вывод:**  На данном графике отсутствует очевидная зависимость потребления алкоголя и количество прогулов, так как больше всего прогульщиков употребляют много (high) алкоголя, однако, наименьшее количество прогулов у "почти не пьющих".
Относительно успеваемости, незачеты получают лишь те, кто злоуботребляет алкоголем, что явно отражено на диаграмме.

## Вопрос 3: Коррелирует ли употребление алкоголя со здоровьем учеников?



```{r Употребление алкоголя и здоровье}

ggplot(gp) +
  geom_bar(aes(x=Dalc, fill = health), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Соотношение здоровья с потреблением алкоголя",
    x = "Потребление алкоголя",
    y = "Соотношение",
    fill = "Состояние здоровья"
  )
```

**Вывод:** В целом, потребление алкоголя не влияет на здоровье учеников. Однако, заметно, что ученики, употребляющие алкоголь в средних количествах, чувствуют себя лучше, чем прочие группы, а ученики, употребляющие алкоголь очень часто - характеризуют свое состояние как "хорошее".

## Вопрос 4: Какие социальные факторы коррелируют с потреблением алкоголя?



### Пол и возраст

```{r Пол, возраст и потребление алкоголя}

ggplot(gp) +
  geom_bar(aes(x = sex, fill = Walc), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Пол и употребление алкоголя",
    x = "Пол",
    y = "Соотношение",
    fill = "Употребление алкоголя"
  )
ggplot(gp) +
  geom_histogram(aes(x=age, y = ..count.. ), binwidth = 1) +
  facet_wrap(~Walc, ncol = 2) +
  # scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Возраст и употребление алкоголя",
    x = "Возраст",
    y = "Количество наблюдений",
    fill = "Употребление алкоголя"
  )
```


**Вывод:** Девушки в целом употребляют меньше алкоголя. Молодые люди употребляют заметно чаще алкоголь в "очень больших количествах", а девушки в "средних" и "очень малых". Большинство младших учеников употребляет алкоголь в "очень малых" количествах. С возрастом начинает расти и потребление. Однако, фокус смещается обратно на более молодых учеников при "среднем употреблении алкоголя".

### Место проживания (тип адреса)

```{r Место проживания}

ggplot(gp) +
  geom_bar(aes(x=address, fill = Walc), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Тип адреса и употребление алкоголя",
    x = "Адрес",
    y = "Соотношение",
    fill = "Употребление алкоголя"
  )
```

**Вывод:** В целом различия между проживающими в сельской местности и городах незначительны. Однако, проживающие в городах употребляют алкоголь в "средних" количествах чаще (зато меньше употребляют в "очень больших" количествах).

### Размер семьи и сожительство родителей

```{r Размер семьи и сожительство родителей}

ggplot(gp) +
  geom_bar(aes(x=Walc, fill = famsize), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Размер семьи и употребление алкоголя",
    x = "Употребление алкоголя",
    y = "Соотношение",
    fill = "Размер семьи"
  )
ggplot(gp) +
  geom_bar(aes(x=Walc, fill = Pstatus), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Сожительство родителей и употребление алкоголя",
    x = "Употребление алкоголя",
    y = "Соотношение",
    fill = "Сожительство родителей"
  )
```


**Вывод:** Чаще алкоголь употребляют многодетные семьи. Большинство учеников живут с родителями. При этом чаще (против своей группы) употребляют алкоголь "в очень низких" и "высоких" размерах ученики, живущие одни. Можно предположить, что это объясняется тем, что в случае "очень низких" размеров ученики, живущие одни склонны больше себя контролировать. В случае "высоких" - наоборот - "эффект отсутствия контроля" со стороны родителей.


### Род занятий родителей

```{r Род занятий родителей}

ggplot(gp) +
  geom_bar(aes(x=Mjob, fill = Walc), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Род занятий матери и употребление алкоголя",
    x = "Употребление алкоголя",
    y = "Соотношение",
    fill = "Род занятий матери"
  )
ggplot(gp) +
  geom_bar(aes(x=Fjob, fill = Walc), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Род занятий отца и употребление алкоголя",
    x = "Род занятий отца",
    y = "Соотношение",
    fill = "Употребление алкоголя"
  )
```


**Вывод:** В случае матери, доли распределились примерно равным образом. Школьники с матерями, работающими в области здравоохранения меньше склонны употреблять алкоголь в "очень больших" количествах. В случае с отцами - ситуация интереснее. Школьники, с неработающими отцами вообще не склонны употреблять алкоголь в "очень больших" количествах, а в семьях с отцами, работающими, в области службы - чаще, по сравнению с другими формами занятости отцов, употребляют алкоголь в "очень больших" количествах. Выделяются также преимущественное "очень низкое" употреление алкоголя среди школьников, чьи отцы работают в области здравоохранения или не работают. В данных случаях можно предполагать о наличии определенного влияния семьи.


### Социальные отношения


```{r Социальные отношения и потребление алкоголя}

ggplot(gp) +
  geom_bar(aes(x=famrel, fill = Walc), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Семейные отношения и потребление алкоголя",
    x = "Семейные отношения",
    y = "Соотношение",
    fill = "Потребление алкоголя"
  )
ggplot(gp) +
  geom_bar(aes(x=romantic, fill = Walc), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Романтические отношения и потребление алкоголя",
    x = "Романтические отношения",
    y = "Соотношение",
    fill = "Употребление алкоголя"
  )
ggplot(gp) +
  geom_bar(aes(x=goout, fill = Walc), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Дружба и потреблением алкоголя",
    x = "Дружба",
    y = "Соотношение",
    fill = "Потребление алкоголя"
  )
```


**Вывод:** -Уровень потребления алкоголя заметно выше в семьях, где явно преобладают очень плохие отношения между собой, в свою очередь, в семьях, внутри которых отношения очень хорошие, употребление алкоголя меньше, но не значительно, если сравнивать с хорошими/средними/плохими отношениями. Соответственно, очень плохие отношения пораждают высокую тягу к алкоголю. 
-Состоит ли человек в романтических отношениях или нет, никак не соотносится с потреблением алкоголя, что отлично показывает график. 
-Что касается дружеских отношений и потребления алкоголя, на графике заметно выражена наиболее высокая склонность к потреблению алкоголя у людей, у которых высокий уровень дружеских отношений. 

## Вопрос 5: Какие корректирующие действия являются более эффективными?



```{r Корректирующие действия и оценки}

ggplot(gp,
  mapping = aes (x = schoolsup, fill = schoolsup, y = G3)) +
  geom_boxplot() +
  labs(
    title = "Доп образование",
    x = "Уровень потребления",
    y = "Оценка",
    fill = "Доп. образование")
ggplot(gp,
  mapping = aes (x = famsup, fill = famsup, y = G3)) +
  geom_boxplot() +
  labs(
    title = "Семейная поддержка",
    x = "Уровень потребления",
    y = "Оценка",
    fill = "Семейная поддержка")
ggplot(gp,
  mapping = aes (x = paid, fill = paid,  y = G3)) +
  geom_boxplot() +
  labs(
    title = "Платные классы",
    x = "Уровень потребления",
    y = "Оценка",
    fill = "Платные классы")
ggplot(gp,
  mapping = aes (x = activities, fill = activities, y = G3)) +
  geom_boxplot() +
  labs(
    title = "Внеклассные мероприятия",
    x = "Уровень потребления",
    y = "Оценка")
```

**Вывод:** Наиболее эффективными корректирующими действиями из четырех предложенных являются платные классы и внеклассные мероприятия, так как они наиболее способствуют повышению среднего балла. При этом внеклассные мероприятия немного более эффективны, чем платные занятия.
