---
title: "Анализ данных об употреблении алкоголя школьниками"
author: Б. Романов, М. Вотякова, Д. Пак
output:
  html_document:
    toc: true
    toc_float: true
---

# Введение

В этом задании вы сможете попрактиковаться в визуализации и разведочном анализе данных. Ваша задача заключается в поиске факторов, связанных с потреблением алкоголя среди учеников средней школы.

Данные были собраны Paul Cortez и Alice Silva путем опроса, проведенного среди учеников португальских школ. Были собраны основные социальные и демографические данные, а также данные успеваемости каждого ученика. Позже набор данных стал частью репозитория машинного обучения UCI благодаря исследователям Fabio Pagnotta и Hossain Mohammad. Информация о наборе данных доступна по ссылке: [здесь](https://archive.ics.uci.edu/ml/datasets/STUDENT+ALCOHOL+CONSUMPTION) или [здесь](http://archive.ics.uci.edu/ml/datasets/student+performance).
Рекомендуется ознакомиться со статьей, приложенной к набору данных на сайте, чтобы получить представление о методологии сбора данных и интерпретации авторов.

Для использования в этом задании, было выбрано подмножество изначальных данных, оно доступно в файле [student-mat.xlsx](student-mat.xlsx). Файл содержит данные об успеваемости слушателей по математике. Коды для категориальных переменных были заменены текстовыми метками для упрощения интерпретации.

## Информация об атрибутах:

- `school` - школа
- `sex` - пол школьника (`F` - женский и `M` - мужской)
- `age` - возраст школьника (числовой: от `15` до `22`)
- `address` - тип адреса школьника (`urban` (городской) или `rural` (сельский))
- `famsize` - размер семьи (`3 or less`, `4 or more`)
- `Pstatus` - родительский статус сожительства (`living together` или `living apart`)
- `Medu` - образование матери (упорядоченный: от `0 - none` до `4 - higher education`)
- `Fedu` - образование отца (также, как и в `Medu`)
- `Mjob` - работа матери (номинальный: `teacher`, `health` работники здравоохранения, гуманитарные `services` (например, административный работник или полицейский), `at_home` или `other`)
-  `Fjob` - работа отца (также, как и в `Mjob`)
- `reason` - причина выбора школы (номинальный: близость к дому `home`, репутация школы `reputation`, `course` предпочтение курсу или `other`)
- `guardian` - опекун студента (номинальный: `mother`, `father` или `other`)
- `traveltime` - время пути от школы до дома (упорядоченный: `1 - <15 min.`, `2 - 15 to 30 min.`, `3 - 30 min. to 1 hour`, или `4 - >1 hour`)
- `studytime` - количество часов обучения в неделю (упорядоченный: `1 - <2 hours`, `2 - 2 to 5 hours`, `3 - 5 to 10 hours`, или `4 - >10 hours`)
- `failures` - количество проваленных классов (числовой: n если 1<=n<3, иначе `4`)
- `schoolsup` - дополнительная образовательная подержка (да или нет)
- `famsup` - семейная образовательная поддержка (да или нет)
- `paid` - дополнительные платные курсы по предмету (математика) (да или нет)
- `activities` - внеклассные занятия (да или нет)
- `nursery` - было ли обучение в детском саду (да или нет)
- `higher` - есть желание к высшему образованию (да или нет)
- `internet` - доступ к интернету дома (да или нет)
- `romantic` - в романтических отношениях (да или нет)
- `famrel` - качество семейных отношений (упорядоченный: от `1 - very bad` до `5 - excellent`)
- `freetime` - свободное время после школы (упорядоченный: от `1 - very low` до `5 - very high`)
- `goout` - прогулки с друзьями (также, как и в `freetime`)
- `Dalc` - потребление алкоголя в течении рабочего дня (как в `freetime`)
- `Walc` - потребление алкоголя на выходных (как в `freetime`)
- `health` - текущий статус здоровья (упорядоченный: от `1 - very bad` до `5 - very good`)
- `absences` - количество прогулов (числовой: от `0` до `93`)
- `G1` - оценка за первый период (числовой: от `0` до `20`)
- `G2` - оценка за второй период (как в `G1`)
- `G3` - финальная оценка (как в `G1`)


## Задание

Визуализируйте данные с помощью ggplot2, чтобы ответить на вопросы, перечисленные ниже. Сделайте выводы по каждому вопросу и запишите их после каждого графика. Все графики должны иметь осмысленные названия, описывающие их содержимое, понятные подписи осей и легенды.

**Подсказки:**

- Примеры графиков, которые можно использовать для ответа на вопросы, содержатся в файле [example_multivariate_plots.pdf](exmple_multivariate_plots.pdf).

- Вам может пригодиться глава из книги R for Data Science: [Graphics for Communication](http://r4ds.had.co.nz/graphics-for-communication.html).

- Также вы можете заглянуть в следующую главу этой книги: [Exploratory data analysis](http://r4ds.had.co.nz/exploratory-data-analysis.html).

- Обратите внимание, что большинство переменных в этом наборе данных - категориальные. Некоторые из них, такие как `sex` или `Medu` - номинальные, не имеющие порядка. Некоторые различаются по уровням, они упорядочены (`goout`, `health`). Прочитайте этот [пост в блоге](https://www.r-bloggers.com/choosing-colour-palettes-part-ii-educated-choices/) по выбору подходящей палитры в зависимости от типов исследуемых данных. Интерактивный гид по выбору подходящей палитры вы можете найти здесь: [colorbrewer](http://colorbrewer2.org/) Вы можете прочитать о задаче каждой палитры, нажав иконку 'i' на этой странице. Вы можете настроить цветовую шкалу при помощи функций `scale_color_brewer()` и `scale_fill_brewer()`.

- Примеры форматирования текста при помощи Markdown вы найдете в блокноте `r-bootcamp/markdown.Rmd`, а также следующих руководствах:

     - [сайт RStudio](http://rmarkdown.rstudio.com/authoring_basics.html)  
     - [шпаргалка](https://www.rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf).


# Инструкции по отправке решения на проверку

1. Скачайте этот файл Rmarkdown себе на компьютер. Обратите внимание, что выполнение задания требует файла с данными - `students-mat.xlsx`, который должен находиться в той же папке, что и .Rmd файл.

2. Разместите свой код для визуализации после каждого вопроса. Кратко интерпретируйте полученные результаты и запишите выводы в виде текста сразу после результата.

3. Удалите из Rmd-файла лишние разделы: `# Задание` и `# Инструкции по отправке решения на проверку`

4. Преобразуйте файл в HTML, нажав на кнопку `Knit` в RStudio. Если в процессе возникает ошибка - смотрите вкладку `R Markdown` в нижней части экрана. 

5. Отправьте мне получившийся HTML-файл.

**Не забудьте указать свое имя в поле 'author:' в начале этого документа!**



# Анализ

Поместите здесь свой код для загрузки библиотек и данных. Для этого задания вам понадобится библиотеки `tidyverse`, `readxl` и `scales`. Используйте `read_excel()` для чтения файла данных.

```{r Загрузка библиотек}
# Ваш код здесь
library (tidyverse)
library(readxl)
library(scales)
std <- read_excel('student-mat.xlsx')
```

## Вопрос 1: Можем ли анализировать данные об учениках двух школ совместно?

Набор данных содержит данные опроса из двух школ Португалии. Чтобы проверить, можно ли проанализировать результаты как единый набор данных, сравните социальные и демографичекие характеристики учащихся в двух школах.

### Сколько наблюдений в каждой школе?

```{r Посчитайте наблюдения в каждой школе}
# Ваш код здесь
ggplot(data = std) +
  geom_bar(mapping = aes(x = school, y = ..count..)) +
  labs(
    title = "Количество наблюдений по школам",
    x = "Школы",
    y = "Количество наблюдений"
  )

gp <- filter(std, school == 'Gabriel Pereira')
mds <- filter(std, school == 'Mousinho da Silveira')

dim(gp)
dim(mds)
```

**Вывод:** Большую часть выборки - 349 наблюдений - составляют данные из школы Gabriel Pereira, оставшиеся 46 наблюдений получены из школы Mousinho da Silveira.

### Похожи ли распределения возрастов в школах?

```{r Сравните возрастные распределения}
# Ваш код здесь
ggplot(data = std) +
  geom_histogram(mapping = aes(x=age, y = ..count..), binwidth =  1) +
  facet_wrap(~school) +
  labs(
    title = "Возрастные распределения",
    x = "Возраст",
    y = "Частота"
  )
```

**Вывод:** В школе Gabriel Pereira (GP) более молодые ученики - преобладают ученики 15-17 лет, в то время как в школе Mousinho da Silveira (MDS) преобладают 18-ти летние ученики.


### Каковы соотношения количества девочек и мальчиков в этих двух школах?

```{r Соотношение полов}
# Ваш код здесь
ggplot(std) +
  geom_bar(aes(x=school, fill = sex), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Соотношение полов",
    x = "Школа",
    y = "Соотношение",
    fill = "Пол"
  )
```

**Вывод:** В обеих школах примерно равный гендерный состав.

### Каковы соотношения учащихся из городских и сельских районов в этих двух школах?

```{r Соотношение сельских и городских жителей}
# Ваш код здесь
ggplot(std) +
  geom_bar(aes(x=school, fill = address), position = 'fill') +
  scale_y_continuous(labels = scales::percent) +
  labs(
    title = "Соотношение полов",
    x = "Школа",
    y = "Соотношение",
    fill = "Район"
  )
```

**Вывод:** В школе GP преобладают ученики, проживающие в городских районах, а в школе MDS примерно поровну, хотя учеников из сельских районов все-таки немного больше.

### Похожи ли размеры семей в этих школах?

```{r Размеры семей по школам}
# Ваш код здесь

```

**Вывод:** ...

### Похожи ли уровни образования родителей учеников этих школ?

```{r Уровень образования родителей по школам}
# Ваш код здесь

```

**Вывод:** ...

### Похожи ли занятия родителей учеников этих школ?

```{r Занятия родителей по школам}
# Ваш код здесь

```

**Вывод:** ...

### Похожи ли причины выбора школы для учеников этих школ?

```{r Причины выбора школы}
# Ваш код здесь

```

**Вывод:** ...

### Схожи ли уровни потребления алкоголя среди учеников этих школ?

Сравните потребление алкоголя в выходные и рабочие дни в этих школах.

```{r Потребление алкоголя среди учеников}
# Ваш код здесь

```

**Вывод:** ...

**Обратите внимание:** Вы можете заметить, что потребление алкоголя в течение рабочего дня гораздо менее распространено в обеих школах. Пожалуйста, используйте потребление алкоголя в выходные дни ("Walc") для дальнейшего анализа, чтобы обеспечить большую точность выводов из-за большего размера выборки.

### Являются ли отношения между потреблением алкоголя и успеваемостью ученика одинаковыми во всех школах?

Сравните распределения и средние финальные оценки (`G3`) для разных уровней употребления алкоголя (` Walc`) в школах.

```{r Потребление алкоголя и финальные оценки}
# Ваш код здесь

```

**Вывод:** ...

Вы можете наблюдать различия в характеристиках учащихся и их эффективности во всех школах. Обе школы демонстрируют довольно неожиданные закономерности в отношении соотношения потребления алкоголя и производительности. Похоже на то, что [пик Баллмера](http://observer.com/2012/04/bottoms-up-the-ballmer-peak-is-real-study-says/) работает и в математике.

Для точности возьмите для дальнейшего анализа данные из школы с наибольшим количеством наблюдений - `Gabriel Pereira`. Используйте функцию `filter()` из пакета `dplyr`, чтобы отфильтровать данные.

**Обратите внимание:** дальше предполагается, что вы загрузили данные в переменную "alco". Поменяйте название переменной в соответствии с тем, что вы использовали.

```{r Подвыборка по школе Gabriel Pereira}
#alco_gp <- filter(alco, school == 'Gabriel Pereira')
```


## Вопрос 2: Коррелирует ли употребление алкоголя с успеваемостью учеников?

Вы уже увидели взаимосвязь между потреблением алкоголя и оценками. Используйте подходящие графики для изучения связи между употреблением алкоголя и другими переменными успеваемости: количество проваленных классов и прогулов.

```{r Употребление алкоголя и успеваемость}
# Ваш код здесь


```

**Вывод:** ...

## Вопрос 3: Коррелирует ли употребление алкоголя со здоровьем учеников?

Визуализируйте связь между употреблением алкоголя и здоровьем учащихся.

```{r Употребление алкоголя и здоровье}
# Ваш код здесь

```

**Вывод:** ...

## Вопрос 4: Какие социальные факторы коррелируют с потреблением алкоголя?

Используйте подходящие графики для изучения корреляции между социальными факторами и употреблением алкоголя.

### Пол и возраст

```{r Пол, возраст и потребление алкоголя}
# Ваш код здесь


```


**Вывод:** ...

### Место проживания (тип адреса)

```{r Место проживания}
# Ваш код здесь

```

**Вывод:** ...

### Размер семьи и сожительство родителей

```{r Размер семьи и сожительство родителей}
# Ваш код здесь



```

**Вывод:** ...


### Род занятий родителей

```{r Род занятий родителей}
# Ваш код здесь


```

**Вывод:** ...


### Социальные отношения

Какие социальные отношения больше коррелируют с потреблением алкоголя: семейные отношения (`famrel`), романтические отношения (`romantic`) или дружба (`goout`)?

```{r Социальные отношения и потребление алкоголя}
# Ваш код здесь

```

**Вывод:** ...

## Вопрос 5: Какие корректирующие действия являются более эффективными?

Сравните распределение финальных оценок (`G3`) для каждого корректирующего действия: дополнительная образовательная поддержка (`schoolsup`), семейная образовательная поддержка (`famsup`), дополнительные платные математические классы (`paid`), внеклассные мероприятия (`activities`).

```{r Корректирующие действия и оценки}
# Ваш код здесь

```

**Вывод:** ...
