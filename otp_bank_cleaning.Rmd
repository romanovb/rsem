---
title: "Исследование и очистка данных клиентской базы ОТП-банка"
author: "Б.Романов, Д.Пак, М.Вотякова"
output: 
  html_document: 
    toc: yes
---
## Требуется
  
  1. Исследуйте данные на предмет наличия пропущенных значений. Для столбцов, содержащих пропущенные значения, предложите стратегию обработки пропусков - фильтрация, замена на типичные значения, замена на специальное значение (`неизвестно`). Примените выбранную стратегию обработки пропущенных значений (очищенные данные поместите в новую таблицу).
  
  2. Изучите распределения всех **количественных** столбцов таблицы. **Категориальные** столбцы на данном этапе рассматривать не надо. Для работы используйте очищенные от пропусков данные, полученные на шаге 1. На основе анализа распределений выберите стратегию обработки аномальных значений (выбросов): фильтрация, замена на типичные значения, винзоризация. Примените выбранную стратегию, очищенные данные поместите в новую таблицу, сохранив имена столбцов.
  
  3. Сравните в абсолютном и процентном выражении, как изменилось количество строк набора данных после очистки.

# Очистка

Загрузка библиотек
```{r Подключение пакетов, message=FALSE, warning=FALSE}
library(tidyverse)
library(readxl) 
library(stringr) 
```

Загрузка данных

```{r Загрузка данных, include=FALSE}
otp <- read_excel(path = "otp_bank.xlsx", sheet = "data")
fields <- read_excel(path = "otp_bank.xlsx", sheet= "fields")

```


О данных

```{r Имена столбцов}
names (otp)
# summary(otp_num)
# names(otp_num)
```


 Создание нового набора данных
```{r Отбор категориальных переменных}
otp_num <- select(otp, -reg_address_province, -fact_address_province,-region_nm, -agreement_rk, - postal_address_province, -job_dir, -gen_industry, -org_tp_state, -org_tp_fcapital, -education, - socstatus_work_fl, -socstatus_pens_fl, -marital_status, -gen_title, -family_income, -tp_province)

```



Фильтрация пропущенных значений

```{r Фильтр}
otp_na <-  filter(otp_num, is.na(work_time)| is.na(previous_card_num_utilized))
```
Строки содержат пропущенные значения либо в столбце стаж работы, либо стаж
Замена пропущенных значений в стаже работы на нулевое будет искажать данные, а вот отсутствие информации об утилизированных картах вполне может означать отсутствие таких карт. Поэтому заменяем стаж работы средним, а количество утилизированных карт на ноль.



Фильтруем категориальные переменные
```{r Категориальные переменные}
otp_cat <- select(otp, reg_address_province, fact_address_province,region_nm, agreement_rk,  postal_address_province, job_dir, gen_industry, org_tp_state, org_tp_fcapital, education,  socstatus_work_fl, socstatus_pens_fl, marital_status, gen_title, family_income, tp_province)


      
```

Поскольку данные переменные являются категориальными, допустимо заменить пропущенные значения аргументом "Неизвестно"

Наконец, производим замены.

```{r Очистка значений}
otp_clean <- mutate(otp, previous_card_num_utilized = if_else(is.na(otp$previous_card_num_utilized), 0, previous_card_num_utilized), work_time = if_else(is.na(otp$work_time), mean(!is.na(otp$work_time)), otp$work_time), reg_address_province = if_else(is.na(otp$reg_address_province), "Неизвестно", otp$reg_address_province), fact_address_province = if_else(is.na(otp$fact_address_province), "Неизвестно", otp$fact_address_province), region_nm = if_else(is.na(otp$region_nm), "Неизвестно", otp$region_nm), postal_address_province = if_else(is.na(otp$postal_address_province), "Неизвестно", otp$postal_address_province), job_dir = if_else(is.na(otp$job_dir), "Неизвестно", otp$job_dir), gen_industry = if_else(is.na(otp$gen_industry), "Неизвестно", otp$gen_industry), org_tp_state = if_else(is.na(otp$org_tp_state), "Неизвестно", otp$org_tp_state), education = if_else(is.na(otp$education), "Неизвестно", otp$education), socstatus_work_fl = if_else(is.na(otp$socstatus_work_fl), "Неизвестно", otp$socstatus_work_fl), socstatus_pens_fl = if_else(is.na(otp$socstatus_pens_fl), "Неизвестно", otp$socstatus_pens_fl), marital_status = if_else(is.na(otp$marital_status), "Неизвестно", otp$marital_status), gen_title = if_else(is.na(otp$gen_title), "Неизвестно", otp$gen_title), family_income = if_else(is.na(otp$family_income), "Неизвестно", otp$family_income), tp_province = if_else(is.na(otp$tp_province), "Неизвестно", otp$tp_province))

```

